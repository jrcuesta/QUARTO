{
  "hash": "c07b023fc5d2b6328a21daffb6704cef",
  "result": {
    "markdown": "---\ntitle: \"Near Infrared Transmitance Tutorial (part 2)\"\ndescription: \"Let use tidyverse to see the spectra and histograms\"\nauthor: \"José Ramón Cuesta\"\nimage: raw_meat_spectra.jpeg\ndraft: false\ndate: \"2022-09-28\"\ncategories: [NIT tutorial]\n---\n\n\nFirst we load the libraries we are going to use, and the \"workspace\" from the previous post:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(modeldata)\nload(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws1.RData\")\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"absorp\"    \"endpoints\" \"tecator\"  \n```\n:::\n:::\n\n\nNow we can create another field called \"SampleID\" as a sequence from 1 to 215 (number of samples), it will be very usefull whenever we use the tecator dataframe:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator <- tecator %>%   \n  rowid_to_column(var = \"SampleID\") \n```\n:::\n\n\nThe tecator data is available as well in the library \"modeldata\", but with the name \"meats\", so we can load it into the workspace and work with it using the tidyverse and tidymodels libraries. The idea of this tutorial is getting use to work with tidyverse and tidymodels at the same time that with classic R.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(meats)\n?meats\n```\n:::\n\n\nThe first 100 columns are the wavelengths are the datapoints and the last 3 the parameters, so we can rename de column names, and add an extra column called \"SampleID\" (same as row number).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(meats) <- c(seq(850, 1048, by = 2), \"Moisture\", \"Fat\", \"Protein\")\n\nmeats <- \n  meats  %>% \n  rowid_to_column(var = \"SampleID\")\n```\n:::\n\n\n\nNow we can see the histograms with ggplot\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeats %>% \n  ggplot(aes(Protein)) +\n  geom_histogram(bins = 20) +\n  ggtitle(\"Protein Meat histogram\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\nWe can do the same for moisture and fat, but with some code we can see all the histograms at the same time:\n\n::: {.cell}\n\n```{.r .cell-code}\nmeats %>% \n  select(SampleID, Moisture, Fat, Protein) %>% \n  pivot_longer(cols = Moisture:Protein,\n               names_to = \"Parameter\",\n               values_to = \"Value\") %>% \n  mutate(Parameter = as.factor(Parameter)) %>% \n  ggplot(aes(Value)) +\n  geom_histogram() +\n  facet_wrap(~ Parameter, scales = \"free_x\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.\n```\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nIn order to see the spectra with ggplot we pivot longer meats data grouping by SampleID:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmeats_longer <- \n  meats  %>% \n  pivot_longer(cols = c(2:101),\n               names_to = \"wavelength\",\n               values_to = \"absorbance\")  %>%  \n  mutate(wavelength = as.integer(str_extract(wavelength, \"[:digit:]+\")))\n\nmeats_longer  %>% \n  ggplot(aes(x = wavelength, y = absorbance, group = SampleID)) + \n  geom_line(alpha = 0.5) + \n  theme_light()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\nSave the workspace for future use\n\n::: {.cell}\n\n```{.r .cell-code}\nsave.image(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws2.RData\")\n```\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}