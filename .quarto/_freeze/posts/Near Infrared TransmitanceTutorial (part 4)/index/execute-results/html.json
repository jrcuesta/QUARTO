{
  "hash": "0924a22cfc9926542886591d9dd1a03f",
  "result": {
    "markdown": "---\ntitle: \"Near Infrared Transmitance Tutorial (part 4)\"\nauthor: \"José Ramón Cuesta\"\ndescription: \"Along the coming post we will se several math treatments trying to improve the correlation between the predictors and the outcomes. In this one SNV\"\ndate: \"2022-10-03\"\nimage: SNV math treated.jpeg\ncategories: [NIT Tutorial]\n---\n\n\nLet´s see what we have in the workspace from the previous posts:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws3.RData\")\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"absorp\"           \"cor_rawspec\"      \"cor_rawspec_fat\"  \"cor_rawspec_moi\" \n[5] \"cor_rawspec_prot\" \"endpoints\"        \"meats\"            \"meats_longer\"    \n[9] \"tecator\"         \n```\n:::\n:::\n\n\nWe can remove some objects we don´t need\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrm(\"cor_rawspec_fat\", \"cor_rawspec_moi\", \"cor_rawspec_prot\")\n```\n:::\n\n\nNow we load the libraries we will use:\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n:::\n\n\nThe idea now is to apply some math treatments to the raw spectra and check which one improves the correlation with the parameters of interest. Normally there are some common scatter removal algorithms that I use:\n\n-   Standard Normal Variate (SNV)\n\n-   Detrend (linear or quadratic)\n\n-   SNV + Detrend (linear or quadratic)\n\n-   Multiple Scatter Correction\n\nThere are some packages in R which have these math treatment with this name or a similar one, or we can create functions to apply these algorithms to the spectra matrix.\n\nLet´s start using SNV, where we center every spectrum (subtracting the mean) and scale it (dividing by the standard deviation):\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#The algorithm is applied to the columns, so we transpose the matrix\nabsorp_snv <- scale(t(absorp), center = TRUE, scale = TRUE)\n#Let´s convert the corrected matrix as usual\nabsorp_snv <- t(absorp_snv)\n\nmatplot(colnames(absorp_snv), t(absorp_snv), type = \"l\", xlab = \"Wavelength (nm)\", ylab = \"Absorbance\", main = \"SNV Meat Spectra\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWe can add the matrix treated with the SNV math treatment to the tecator dataframe\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator$snv_spec <- absorp_snv\n```\n:::\n\n\nNow we can see if the correlation is improved\n\n::: {.cell}\n\n```{.r .cell-code}\ncor_snvspec_moi <- cor(tecator$Moisture, tecator$snv_spec)\ncor_snvspec_fat <- cor(tecator$Fat, tecator$snv_spec)\ncor_snvspec_prot <- cor(tecator$Protein, tecator$snv_spec)\n\ncor_snvspec <- as.data.frame(rbind(cor_snvspec_moi, cor_snvspec_fat, cor_snvspec_prot))\n\ncor_snvspec <- cor_snvspec %>% \n  mutate(Parameter = as.factor(c(\"Moisture\", \"Fat\", \"Protein\")))\n\ncor_snvspec %>% \n  pivot_longer(cols = c(1:100), names_to = \"Wavelength\", values_to = \"Correlation\") %>% \n  mutate(Wavelength = as.integer(Wavelength)) %>% \n  ggplot(aes(x = Wavelength, y = Correlation, group = Parameter, col = Parameter)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nNow, apart from the better correlation we can see an improvement in the definition of the correlations (positives and negatives), and the correlation spectra confirm what we have seen in the correlation between the parameters.",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}