{
  "hash": "294be77ba8f074579115320e032286de",
  "result": {
    "markdown": "---\ntitle: \"PCA - NIT tutorial (part 12)\"\nauthor: \"José Ramón Cuesta\"\ndescription: \"Looking for outliers in the intercorrelation plots\"\ndate: \"2022-12-19\"\nimage: Mahal_dist_spec.jpeg\ncategories: [R, NIT Tutorial, PCA]\n---\n\n\nIn a previous post (from this tutorial) we have seen the intercorrelation plots between parameters and we have seen some outliers (they did not follow the trend), but are those samples mahalanobis distance spectral outliers, for the math treatment used?. Now we can go back to that point and check it.\n\nLet\\`s start by loading our workspace and the libraries we are going to use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nload(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws11.RData\")\nlibrary(tidyverse)\n```\n:::\n\n\n## Moisture vs Fat\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator2 %>% \n  ggplot(aes( x = Moisture, y = Fat, color = outlier)) +\n  geom_point() + \n  geom_smooth(method = lm, size = 1) +\n  scale_color_manual(values = c(\"no outlier\" = \"green\",\n                                \"Warning outlier\" = \"orange\",\n                                \"Action outlier\" =\"red\"))\n```\n\n::: {.cell-output-display}\n![](NIT_tutorial_12_files/figure-html/Moi_Fat-1.png){width=672}\n:::\n:::\n\n\nIn this case we can see how the extreme samples (with high fat and low moisture are action or warning outliers), and that some of the high moisture - low fat outliers dis not follow the trend.\n\n## Moisture vs Protein\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator2 %>% \n  ggplot(aes( x = Moisture, y = Protein, color = outlier)) +\n  geom_point() + \n  geom_smooth(method = lm, size = 1) +\n  scale_color_manual(values = c(\"no outlier\" = \"green\",\n                                \"Warning outlier\" = \"orange\",\n                                \"Action outlier\" =\"red\"))\n```\n\n::: {.cell-output-display}\n![](NIT_tutorial_12_files/figure-html/Moi_Prot-1.png){width=672}\n:::\n:::\n\n\nin this case we do not see that almost all the low moisture - low protein are marked as outliers, but the rest of the outliers (except two warning) follow the trend.\n\n## Fat vs Protein\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator2 %>% \n  ggplot(aes( x = Fat, y = Protein, color = outlier)) +\n  geom_point() + \n  geom_smooth(method = lm, size = 1) +\n  scale_color_manual(values = c(\"no outlier\" = \"green\",\n                                \"Warning outlier\" = \"orange\",\n                                \"Action outlier\" =\"red\"))\n```\n\n::: {.cell-output-display}\n![](NIT_tutorial_12_files/figure-html/Fat_Prot-1.png){width=672}\n:::\n:::\n\n\nit seems the same case than Protein vs Moisture.\n\n## Relation between the spectra pattern an the Mahalanobis distance ranges\n\nOther observation we can do is with the spectra math treated giving colors to the spectra math treated, and looking if we see some patterns: (First we have to do some work removing the prefix (snvdt2der2_spec.)to the wavelength headers).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator3 <- bind_cols(tecator2$SampleID, tecator2$snvdt2der2_spec, tecator2$outlier) \ncolnames(tecator3) <- c(\"SampleID\", seq(850, 1048, 2), \"outlier\")\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntecator3  %>% \n  pivot_longer(cols = c(2:101),\n               names_to = \"wavelength\",\n               values_to = \"absorbance\")  %>%  \n  mutate(wavelength = as.integer(str_extract(wavelength, \"[:digit:]+\"))) %>% \n    ggplot(aes(x = wavelength, y = absorbance, group = SampleID, color = outlier)) + \n  geom_line(alpha = 0.5) + \n  scale_color_manual(values = c(\"no outlier\" = \"green\",\n                                \"Warning outlier\" = \"orange\",\n                                \"Action outlier\" =\"red\")) +\n  theme_light()\n```\n\n::: {.cell-output-display}\n![](NIT_tutorial_12_files/figure-html/tecator3_2-1.png){width=672}\n:::\n:::\n\n\nIn the spectra we can see how the warning and action mahalanobis distance outliers are also extreme vs. the absorbance values. We have to take into account that these absorbances have a relationship with the concentration of the parameters: Fat, Moisture and Protein.\n\nNow we save the workspace to use in the next post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave.image(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws12.RData\")\n```\n:::\n",
    "supporting": [
      "NIT_tutorial_12_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}