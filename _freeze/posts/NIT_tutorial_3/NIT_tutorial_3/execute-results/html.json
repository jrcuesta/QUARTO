{
  "hash": "18eab31fc62a946aa648fbf233f18a53",
  "result": {
    "markdown": "---\ntitle: \"Near Infrared Transmitance Tutorial (part 3)\"\ndescription: \"Let´s check the correlation between the outcomes, between the predictors and between outcomes and predictors\"\nauthor: \"José Ramón Cuesta\"\nimage: cor_parameters.jpeg\ndate: \"2022-09-29\"\ncategories: [R, NIT Tutorial, Collinearity]\n---\n\n\n## Organizing data\n\nLet´s start loading the libraries we are going to use in this post and the workspace from the previous post.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(corrplot)\nload(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws2.RData\")\nls()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"absorp\"       \"endpoints\"    \"meats\"        \"meats_longer\" \"tecator\"     \n```\n:::\n:::\n\n\n## Correlation between the parameters (outcomes)\n\nIt is important to check the correlation between the outcomes variables (Moisture, Fat and Protein in this case). As we remember the outcomes are in the \"endpoints\" matrix.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nendpoints %>% \n  cor()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n           Moisture        Fat    Protein\nMoisture  1.0000000 -0.9881002  0.8145212\nFat      -0.9881002  1.0000000 -0.8608965\nProtein   0.8145212 -0.8608965  1.0000000\n```\n:::\n:::\n\n\nThe correlation matrix show how the are high correlations between the three parameters, but we can use graphics to see it more clearly:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(cor(endpoints), method = \"ellipse\")\n```\n\n::: {.cell-output-display}\n![Inter-correlation between parameters.](NIT_tutorial_3_files/figure-html/fig-cor_params-1.png){#fig-cor_params width=672}\n:::\n:::\n\n\nBut to check better the trends and the possible outliers, we can use the function \"pairs\n\n\n::: {.cell}\n\n```{.r .cell-code}\npairs(endpoints)\n```\n\n::: {.cell-output-display}\n![Parameters inter-correlation](NIT_tutorial_3_files/figure-html/fig-params_cor-1.png){#fig-params_cor width=672}\n:::\n:::\n\n\nThis way we can see at least six outliers that seems to have some bias versus the linear trend. What are the reason for these outliers? (samples different from the rest, different reference method, bias in the reference method,...). We will try to see along the tutorial.\n\n## Correlation between the wavelengths (predictors)\n\nIt is known that the NIR or NIT predictor variables are highly correlated, due that we are working with overtones and combination bands, so the correlation matrix in this case show high correlation between all the variables, due to we are in the third overtone and working with very broad bands.For this reason we have to apply math treatments to the spectra to remove the scatter effect and derivatives to improve the resolution of the bands. The correlation between predictors is a long matrix (100.100), so the best way to see it it is graphically. By now we see the correlation matrix of the raw spectra (without any math treatment)\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncorrplot(cor(absorp), method = \"circle\", type = \"upper\", tl.cex = 0.5)\n```\n\n::: {.cell-output-display}\n![Spectra collinearity.](NIT_tutorial_3_files/figure-html/fig-spec_collinearity-1.png){#fig-spec_collinearity width=672}\n:::\n:::\n\n\n## Correlation between outcomes and predictors\n\nAnother point is how the variation in the predictors matrix correlates with the variation of the outcomes. What we do is to see which wavelengths correlate better with a certain parameter getting three correlation spectra (one for every parameter).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncor_rawspec_moi <- cor(tecator$Moisture, tecator$spec)\ncor_rawspec_fat <- cor(tecator$Fat, tecator$spec)\ncor_rawspec_prot <- cor(tecator$Protein, tecator$spec)\n\ncor_rawspec <- as.data.frame(rbind(cor_rawspec_moi, cor_rawspec_fat, cor_rawspec_prot))\ncor_rawspec <- cor_rawspec %>% \n  mutate(Parameter = as.factor(c(\"Moisture\", \"Fat\", \"Protein\")))\n\ncor_rawspec %>% \n  pivot_longer(cols = c(1:100), names_to = \"Wavelength\", values_to = \"Correlation\") %>% \n  mutate(Wavelength = as.integer(Wavelength)) %>% \n  ggplot(aes(x = Wavelength, y = Correlation, group = Parameter, col = Parameter)) +\n  geom_line()\n```\n\n::: {.cell-output-display}\n![Correlation absorbance vs. parameters.](NIT_tutorial_3_files/figure-html/fig-cor_wavel_params-1.png){#fig-cor_wavel_params width=672}\n:::\n:::\n\n\nAs we can see there are no wavelengths with high correlations, and if we would auto-scale every correlation spectrum, the spectrum would seem as a meat sample spectra (for moisture and protein inverted). All this is due to the scatter physical effects. So, with some math treatments to remove it the correlation will improve. Anyway, in the third overtone due to the bands overlapping, we would need a multivariate calibration with all or almost all the wavelengths.\n\nAs always save the workspace for future use:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsave.image(\"C:/BLOG/Workspaces/NIT Tutorial/NIT_ws3.RData\")\n```\n:::\n",
    "supporting": [
      "NIT_tutorial_3_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}